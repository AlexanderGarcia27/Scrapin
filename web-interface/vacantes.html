<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Vacantes destacadas</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen">
  <div class="flex flex-col items-center min-h-screen py-8 px-8">
    <div class="w-full max-w-6xl bg-white rounded-lg shadow p-8 mb-8">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold">Vacantes destacadas</h1>
        <button onclick="goBack()" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white font-bold rounded shadow">←
          Volver</button>
      </div>

      <!-- Filtros -->
      <div class="flex justify-center gap-4 mb-8">
        <button onclick="render('todas')" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white font-bold rounded shadow">Todas</button>
        <button onclick="render('mayor')" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white font-bold rounded shadow">Mayor sueldo</button>
        <button onclick="render('menor')" class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white font-bold rounded shadow">Menor sueldo</button>
      </div>

      <!-- Contenido dinámico -->
      <div id="vacantesContainer" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
    </div>
  </div>

  <script>
    let todasVacantes = [];

    async function getVacantes() {
      const res = await fetch('/resultados.json');
      const data = await res.json();
      return data.filter(v => v.sueldo && parseFloat(v.sueldo.replace(/[^\d.]/g, '')) > 0);
    }

    function parseSueldo(sueldo) {
      if (!sueldo) return 0;
      const match = sueldo.replace(/,/g, '').match(/\d+/);
      return match ? parseInt(match[0], 10) : 0;
    }

    function createCard(v) {
      return `<div class="bg-white rounded-lg shadow p-5 w-full max-w-xs mx-auto flex flex-col gap-2 border border-cyan-100">
        <div class="font-bold text-lg">${v.nombreVacante || 'Sin título'}</div>
        <div class="text-gray-700">${v.empresa || 'No se muestra la empresa'}</div>
        <div class="text-gray-500 text-sm">${v.ubicacion || 'Sin ubicación'}</div>
        <div class="text-gray-500 text-sm">${v.detalles?.["Espacio de trabajo"] || 'Sin modalidad'}</div>
        <div class="text-cyan-700 font-bold text-lg mt-1">${v.sueldo}</div>
      </div>`;
    }

    async function render(filtro = 'todas') {
      const contenedor = document.getElementById('vacantesContainer');

      if (todasVacantes.length === 0) {
        todasVacantes = await getVacantes();
      }

      if (!todasVacantes.length) {
        contenedor.innerHTML = '<div class="text-gray-500">No hay vacantes con sueldo.</div>';
        return;
      }

      let vacantes = [...todasVacantes];
      vacantes.sort((a, b) => parseSueldo(b.sueldo) - parseSueldo(a.sueldo));

      const n = getCantidad(vacantes.length);

      if (filtro === 'mayor') {
        vacantes = vacantes.slice(0, n);
      } else if (filtro === 'menor') {
        vacantes = vacantes.reverse().slice(0, n);
      }

      contenedor.innerHTML = vacantes.map(createCard).join('');
    }

    function getCantidad(total) {
      if (total > 30) return 10;
      if (total >= 20) return 8;
      if (total >= 10) return 5;
      return Math.min(3, Math.floor(total / 2));
    }

    // Estilos botones filtros
    const style = document.createElement('style');
    style.innerHTML = `
      .tag-button {
        @apply px-4 py-2 rounded shadow font-bold transition duration-200;
      }
      .tag-button:hover {
        @apply opacity-90;
      }
    `;
    document.head.appendChild(style);

    render(); // por defecto muestra todas
    function goBack() {
      window.location.href = 'index.html';
      setTimeout(() => location.reload(), 200); // recarga la página del buscador
    }
  </script>
</body>

</html>